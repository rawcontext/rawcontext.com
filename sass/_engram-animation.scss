// ============================================
// NEURAL ENGRAM - Brain Animation
// Neurons firing and memory formation
// ============================================

// Main container
.neural-engram {
    position: relative;
    width: 380px;
    height: 380px;
    transform-style: preserve-3d;
    perspective: 1200px;
}

// ============================================
// Ambient Neural Field (Neurotransmitters)
// ============================================
.neural-field {
    position: absolute;
    inset: -40px;
    pointer-events: none;
}

.vesicle {
    position: absolute;
    width: 3px;
    height: 3px;
    border-radius: 50%;
    opacity: 0.3;

    &:nth-child(1) { top: 8%; left: 12%; background: var(--signal-primary); animation: vesicleFloat 11s ease-in-out infinite; }
    &:nth-child(2) { top: 22%; left: 88%; background: rgba(255, 255, 255, 0.6); animation: vesicleFloat 9s ease-in-out 1.3s infinite; }
    &:nth-child(3) { top: 45%; left: 5%; background: var(--signal-primary); animation: vesicleFloat 13s ease-in-out 2.7s infinite; }
    &:nth-child(4) { top: 68%; left: 92%; background: rgba(255, 255, 255, 0.6); animation: vesicleFloat 10s ease-in-out 0.9s infinite; }
    &:nth-child(5) { top: 85%; left: 15%; background: var(--signal-secondary); animation: vesicleFloat 12s ease-in-out 3.1s infinite; }
    &:nth-child(6) { top: 12%; left: 75%; background: rgba(255, 255, 255, 0.6); animation: vesicleFloat 14s ease-in-out 1.7s infinite; }
    &:nth-child(7) { top: 78%; left: 80%; background: var(--signal-primary); animation: vesicleFloat 11s ease-in-out 2.3s infinite; }
    &:nth-child(8) { top: 55%; left: 8%; background: var(--signal-secondary); animation: vesicleFloat 10s ease-in-out 0.5s infinite; }
}

// ============================================
// Tech Grid Overlay
// ============================================
.tech-grid {
    position: absolute;
    inset: 0;
    background-image:
        linear-gradient(rgba(0, 212, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 212, 255, 0.03) 1px, transparent 1px);
    background-size: 20px 20px;
    mask-image: radial-gradient(ellipse 85% 80% at 50% 50%, black 30%, transparent 70%);
    -webkit-mask-image: radial-gradient(ellipse 85% 80% at 50% 50%, black 30%, transparent 70%);
    opacity: 0.6;
}

// ============================================
// Cyborg Brain Silhouette
// ============================================
.brain-silhouette {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    overflow: visible;
}

// Outer glow layer (blurred background)
.brain-outline-glow {
    fill: none;
    stroke: var(--signal-primary);
    stroke-width: 6;
    stroke-opacity: 0.15;
    filter: url(#brainGlowStrong);
    animation: brainOutlinePulse 6s ease-in-out infinite;
}

.brain-outline {
    fill: rgba(0, 212, 255, 0.02);
    stroke: url(#brainStrokeGradient);
    stroke-width: 2.5;
    stroke-opacity: 0.8;
    stroke-linecap: round;
    stroke-linejoin: round;
    filter: url(#brainGlow);
    animation: brainOutlinePulse 6s ease-in-out infinite;
}

// Inner detail outline
.brain-outline-inner {
    fill: none;
    stroke: var(--signal-primary);
    stroke-width: 1;
    stroke-opacity: 0.2;
    stroke-dasharray: 3 6;
    animation: brainOutlinePulse 6s ease-in-out 0.5s infinite;
}

.brain-stem {
    fill: none;
    stroke: var(--signal-primary);
    stroke-width: 1.5;
    stroke-opacity: 0.3;
    filter: drop-shadow(0 0 6px rgba(0, 212, 255, 0.2));
}

.cerebellum {
    fill: rgba(0, 212, 255, 0.02);
    stroke: var(--signal-primary);
    stroke-width: 1;
    stroke-opacity: 0.25;
}

.lobe-outline {
    fill: none;
    stroke: rgba(168, 85, 247, 0.2);
    stroke-width: 1;
    stroke-dasharray: 4 4;
    stroke-linecap: round;
}

.gyrus {
    fill: none;
    stroke: rgba(0, 212, 255, 0.25);
    stroke-width: 1.2;
    stroke-linecap: round;
    filter: drop-shadow(0 0 2px rgba(0, 212, 255, 0.2));
}

.sulcus-major {
    fill: none;
    stroke: rgba(168, 85, 247, 0.25);
    stroke-width: 1.5;
    stroke-linecap: round;
    stroke-dasharray: 8 4;
}

// Circuit traces
.circuit-trace {
    fill: none;
    stroke: var(--signal-primary);
    stroke-width: 2;
    stroke-opacity: 0;
    stroke-linecap: square;

    &.ct-1 { animation: circuitDraw 4s ease-out infinite; }
    &.ct-2 { animation: circuitDraw 4s ease-out 1s infinite; }
    &.ct-3 { animation: circuitDraw 4s ease-out 2s infinite; }
    &.ct-4 { animation: circuitDraw 4s ease-out 3s infinite; }
}

.circuit-node {
    fill: var(--signal-primary);
    opacity: 0.5;
    animation: circuitNodePulse 2s ease-in-out infinite;
}

.data-pulse {
    fill: var(--signal-secondary);
    opacity: 0;

    &.dp-1 { animation: dataPulseFlow 4s ease-in-out infinite; }
    &.dp-2 { animation: dataPulseFlow 4s ease-in-out 1s infinite; }
    &.dp-3 { animation: dataPulseFlow 4s ease-in-out 2s infinite; }
    &.dp-4 { animation: dataPulseFlow 4s ease-in-out 3s infinite; }
}

// ============================================
// Scan Line Effect
// ============================================
.scan-line {
    position: absolute;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(0, 212, 255, 0.4) 20%,
        rgba(0, 212, 255, 0.8) 50%,
        rgba(0, 212, 255, 0.4) 80%,
        transparent 100%
    );
    opacity: 0;
    animation: scanLine 8s linear infinite;
    pointer-events: none;
}

// ============================================
// Interface Labels
// ============================================
.interface-labels {
    position: absolute;
    inset: 0;
    pointer-events: none;
}

.label {
    position: absolute;
    font-size: 8px;
    font-weight: 600;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    opacity: 0.4;
    font-family: monospace;

    &.label-memory {
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #a855f7;
        opacity: 0;
        animation: labelFade 6s ease-in-out infinite;
    }

    &.label-input {
        top: 50%;
        left: 5%;
        color: var(--signal-primary);
        animation: labelPulse 4s ease-in-out infinite;
    }

    &.label-output {
        top: 50%;
        right: 5%;
        color: var(--signal-secondary);
        animation: labelPulse 4s ease-in-out 2s infinite;
    }
}

// ============================================
// Synaptic Network (SVG Connections)
// ============================================
.synaptic-network {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
}

.synapse {
    stroke-width: 1.5;
    fill: none;
    stroke-opacity: 0.25;

    &.synapse-sensory {
        stroke: var(--signal-primary);
        animation: synapsePulse 4s ease-in-out infinite;
    }

    &.synapse-motor {
        stroke: var(--signal-secondary);
        animation: synapsePulse 4.5s ease-in-out 0.7s infinite;
    }

    &.synapse-inter {
        stroke: rgba(255, 255, 255, 0.5);
        stroke-opacity: 0.15;
        animation: synapsePulse 5s ease-in-out 1.3s infinite;
    }

    &.synapse-memory {
        stroke: #a855f7;
        stroke-opacity: 0.35;
        animation: memoryPulseSynapse 3.5s ease-in-out infinite;
    }
}

// ============================================
// Neuron Nodes
// ============================================
.neuron-field {
    position: absolute;
    inset: 0;
}

.neuron {
    position: absolute;
    border-radius: 50%;
    transform: translate(-50%, -50%);

    &::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 50%;
    }

    // Dendrite extensions
    &::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 200%;
        height: 200%;
        transform: translate(-50%, -50%);
        border-radius: 50%;
        opacity: 0;
    }
}

// Node sizes (soma size)
.neuron-heavy { width: 14px; height: 14px; }
.neuron-medium { width: 10px; height: 10px; }
.neuron-light { width: 7px; height: 7px; }
.neuron-trace { width: 4px; height: 4px; }

// Neuron types with colors - using mixin for consistency
.neuron-sensory::before {
    @include neuron-gradient($color-primary, 0.5);
}

.neuron-motor::before {
    @include neuron-gradient($color-secondary, 0.5);
}

.neuron-inter::before {
    @include neuron-gradient($color-white, 0.4);
    box-shadow: 0 0 10px rgba($color-white, 0.4); // Override for white
}

.neuron-memory::before {
    @include neuron-gradient($color-memory, 0.6);
}

// ============================================
// Neuron Positions (anatomical brain layout)
// Generated from $neuron-positions map
// ============================================
@each $node, $pos in $neuron-positions {
    .#{$node} {
        top: map-get($pos, top);
        left: map-get($pos, left);
    }
}

// ============================================
// Pulse Animations (staggered at 0.5s intervals)
// ============================================
@for $i from 1 through 8 {
    .pulse-#{$i}::before {
        animation: neuronFire 4s ease-in-out #{($i - 1) * 0.5}s infinite;
    }
}

// ============================================
// Hippocampus Core (Memory Center)
// ============================================
.hippocampus-core {
    position: absolute;
    top: 47%;
    left: 54%;
    transform: translate(-50%, -50%);
    width: 70px;
    height: 45px;
}

.core-glow {
    position: absolute;
    inset: -20px;
    background: radial-gradient(ellipse,
        rgba(168, 85, 247, 0.3) 0%,
        rgba(168, 85, 247, 0.1) 40%,
        transparent 70%
    );
    border-radius: 50%;
    filter: blur(15px);
    animation: coreGlow 3s ease-in-out infinite;
}

.core-pulse {
    position: absolute;
    inset: -30px;
    border-radius: 50%;
    border: 1px solid rgba(168, 85, 247, 0.4);
    opacity: 0;
    animation: corePulseRing 4s ease-out infinite;
}

.core-inner {
    position: absolute;
    inset: 10px;
    background: radial-gradient(ellipse at 40% 40%,
        rgba(168, 85, 247, 0.4) 0%,
        rgba(168, 85, 247, 0.15) 50%,
        transparent 80%
    );
    border-radius: 50%;
    animation: coreInnerPulse 3s ease-in-out infinite;
}

// ============================================
// Neural Impulses (Firing Animation)
// ============================================
.neural-impulses {
    position: absolute;
    inset: 0;
    pointer-events: none;
}

.impulse {
    position: absolute;
    top: 50%;
    left: 50%;
}

.impulse-particle {
    position: absolute;
    width: 6px;
    height: 6px;
    background: var(--signal-primary);
    border-radius: 50%;
    box-shadow:
        0 0 8px var(--signal-primary),
        0 0 16px rgba(0, 212, 255, 0.5);
    opacity: 0;
}

// Impulse paths (from periphery through hippocampus)
// Generated from $impulse-configs map
@each $num, $config in $impulse-configs {
    $path: map-get($config, path);
    $duration: map-get($config, duration);
    $delay: map-get($config, delay);

    .impulse-#{$num} .impulse-particle {
        animation: impulsePath#{$path} $duration ease-in-out $delay infinite;
    }
}

// ============================================
// Engram Formation (Memory Crystallization)
// ============================================
.engram-formation {
    position: absolute;
    inset: 0;
    pointer-events: none;
}

.engram {
    position: absolute;
    width: 20px;
    height: 20px;
    opacity: 0;

    &::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg,
            rgba(168, 85, 247, 0.9) 0%,
            rgba(255, 200, 87, 0.6) 50%,
            rgba(0, 212, 255, 0.4) 100%
        );
        clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
        box-shadow: 0 0 20px rgba(168, 85, 247, 0.6);
    }

    // Generated from $engram-configs map
    @each $num, $config in $engram-configs {
        &.engram-#{$num} {
            top: map-get($config, top);
            left: map-get($config, left);
            animation: engramForm 10s ease-out map-get($config, delay) infinite;
        }
    }
}

// ============================================
// Keyframe Animations
// ============================================

// Vesicle floating
@keyframes vesicleFloat {
    0%, 100% {
        transform: translateY(0) translateX(0);
        opacity: 0.3;
    }
    25% {
        transform: translateY(-8px) translateX(4px);
        opacity: 0.5;
    }
    50% {
        transform: translateY(-4px) translateX(-3px);
        opacity: 0.35;
    }
    75% {
        transform: translateY(4px) translateX(2px);
        opacity: 0.45;
    }
}

// Subtle brain boundary pulse
@keyframes brainPulse {
    0%, 100% {
        opacity: 0.7;
        transform: scale(1);
    }
    50% {
        opacity: 0.9;
        transform: scale(1.02);
    }
}

// Synapse pulse
@keyframes synapsePulse {
    0%, 100% {
        stroke-opacity: 0.2;
        stroke-width: 1.5;
    }
    50% {
        stroke-opacity: 0.5;
        stroke-width: 2;
    }
}

// Memory synapse pulse (hippocampus connections)
@keyframes memoryPulseSynapse {
    0%, 100% {
        stroke-opacity: 0.25;
        stroke-width: 1.5;
    }
    40% {
        stroke-opacity: 0.7;
        stroke-width: 2.5;
    }
    60% {
        stroke-opacity: 0.5;
        stroke-width: 2;
    }
}

// Neuron firing
@keyframes neuronFire {
    0%, 100% {
        transform: scale(1);
        filter: brightness(1);
    }
    50% {
        transform: scale(1.2);
        filter: brightness(1.4);
    }
}

// Core glow
@keyframes coreGlow {
    0%, 100% {
        opacity: 0.6;
        transform: scale(1);
    }
    50% {
        opacity: 1;
        transform: scale(1.1);
    }
}

// Core pulse ring
@keyframes corePulseRing {
    0% {
        opacity: 0.5;
        transform: scale(0.8);
    }
    100% {
        opacity: 0;
        transform: scale(1.6);
    }
}

// Core inner pulse
@keyframes coreInnerPulse {
    0%, 100% {
        opacity: 0.5;
    }
    50% {
        opacity: 0.9;
    }
}

// Impulse paths (Frontal → Hippocampus → Parietal)
@keyframes impulsePathA {
    0% {
        left: -125px;
        top: -70px;
        opacity: 0;
    }
    5% {
        opacity: 1;
    }
    35% {
        left: -40px;
        top: -25px;
        background: var(--signal-primary);
        box-shadow: 0 0 8px var(--signal-primary), 0 0 16px rgba(0, 212, 255, 0.5);
    }
    45% {
        left: 0;
        top: 0;
        background: #a855f7;
        box-shadow: 0 0 12px #a855f7, 0 0 24px rgba(168, 85, 247, 0.6);
    }
    55% {
        left: 0;
        top: 0;
    }
    85% {
        left: 95px;
        top: -35px;
        background: var(--signal-secondary);
        box-shadow: 0 0 10px var(--signal-secondary), 0 0 20px rgba(255, 200, 87, 0.5);
        opacity: 1;
    }
    100% {
        left: 130px;
        top: -55px;
        opacity: 0;
    }
}

// Parietal → Hippocampus → Temporal
@keyframes impulsePathB {
    0% {
        left: 135px;
        top: -75px;
        opacity: 0;
    }
    5% {
        opacity: 1;
    }
    35% {
        left: 60px;
        top: -30px;
        background: var(--signal-primary);
    }
    50% {
        left: 0;
        top: 0;
        background: #a855f7;
        box-shadow: 0 0 12px #a855f7, 0 0 24px rgba(168, 85, 247, 0.6);
    }
    65% {
        left: 0;
        top: 0;
    }
    90% {
        left: -15px;
        top: 100px;
        background: var(--signal-secondary);
        opacity: 1;
    }
    100% {
        left: -30px;
        top: 130px;
        opacity: 0;
    }
}

// Temporal → Hippocampus → Frontal
@keyframes impulsePathC {
    0% {
        left: 35px;
        top: 115px;
        opacity: 0;
    }
    5% {
        opacity: 1;
    }
    40% {
        left: 15px;
        top: 35px;
        background: var(--signal-primary);
    }
    55% {
        left: 0;
        top: 0;
        background: #a855f7;
        box-shadow: 0 0 12px #a855f7, 0 0 24px rgba(168, 85, 247, 0.6);
    }
    70% {
        left: 0;
        top: 0;
    }
    90% {
        left: -100px;
        top: 15px;
        background: var(--signal-secondary);
        opacity: 1;
    }
    100% {
        left: -125px;
        top: 25px;
        opacity: 0;
    }
}

// Quick hippocampus internal loop
@keyframes impulsePathD {
    0% {
        left: -45px;
        top: -20px;
        opacity: 0;
    }
    8% {
        opacity: 1;
        background: #a855f7;
    }
    25% {
        left: -10px;
        top: -15px;
    }
    50% {
        left: 20px;
        top: 10px;
        background: #a855f7;
        box-shadow: 0 0 15px #a855f7, 0 0 30px rgba(168, 85, 247, 0.7);
    }
    75% {
        left: 0;
        top: 25px;
    }
    92% {
        left: -35px;
        top: 15px;
        opacity: 1;
    }
    100% {
        left: -50px;
        top: 5px;
        opacity: 0;
    }
}

// Cross-brain path
@keyframes impulsePathE {
    0% {
        left: -130px;
        top: -30px;
        opacity: 0;
    }
    5% {
        opacity: 1;
    }
    30% {
        left: -60px;
        top: -45px;
        background: var(--signal-primary);
    }
    50% {
        left: 0;
        top: -15px;
        background: #a855f7;
        box-shadow: 0 0 12px #a855f7;
    }
    70% {
        left: 60px;
        top: 20px;
    }
    90% {
        left: 115px;
        top: 85px;
        background: var(--signal-secondary);
        opacity: 1;
    }
    100% {
        left: 135px;
        top: 100px;
        opacity: 0;
    }
}

// Vertical path through hippocampus
@keyframes impulsePathF {
    0% {
        left: 15px;
        top: -120px;
        opacity: 0;
    }
    8% {
        opacity: 1;
    }
    40% {
        left: 5px;
        top: -40px;
        background: var(--signal-primary);
    }
    55% {
        left: 0;
        top: 0;
        background: #a855f7;
        box-shadow: 0 0 14px #a855f7, 0 0 28px rgba(168, 85, 247, 0.6);
    }
    70% {
        left: 0;
        top: 0;
    }
    92% {
        left: -10px;
        top: 110px;
        background: var(--signal-secondary);
        opacity: 1;
    }
    100% {
        left: -15px;
        top: 135px;
        opacity: 0;
    }
}

// Engram crystallization
@keyframes engramForm {
    0% {
        opacity: 0;
        transform: scale(0) rotate(0deg);
    }
    15% {
        opacity: 0.9;
        transform: scale(1.3) rotate(20deg);
    }
    30% {
        opacity: 0.8;
        transform: scale(1.1) rotate(15deg);
    }
    50% {
        opacity: 0.6;
        transform: scale(1) rotate(10deg);
    }
    70% {
        opacity: 0.3;
        transform: scale(0.8) rotate(5deg);
    }
    100% {
        opacity: 0;
        transform: scale(0.5) rotate(0deg);
    }
}

// Brain outline pulse
@keyframes brainOutlinePulse {
    0%, 100% {
        stroke-opacity: 0.6;
        filter: url(#brainGlow);
    }
    50% {
        stroke-opacity: 1;
        filter: url(#brainGlowStrong);
    }
}

// Circuit trace draw
@keyframes circuitDraw {
    0% {
        stroke-opacity: 0;
        stroke-dasharray: 100;
        stroke-dashoffset: 100;
    }
    20% {
        stroke-opacity: 0.8;
    }
    50% {
        stroke-dashoffset: 0;
        stroke-opacity: 0.6;
    }
    80% {
        stroke-opacity: 0.3;
    }
    100% {
        stroke-opacity: 0;
        stroke-dashoffset: 0;
    }
}

// Circuit node pulse
@keyframes circuitNodePulse {
    0%, 100% {
        opacity: 0.4;
        r: 4;
    }
    50% {
        opacity: 0.8;
        r: 5;
    }
}

// Data pulse flow along circuits
@keyframes dataPulseFlow {
    0% {
        opacity: 0;
        transform: scale(1);
    }
    20% {
        opacity: 1;
        transform: scale(1.5);
    }
    40% {
        opacity: 0.8;
    }
    100% {
        opacity: 0;
        transform: scale(1);
    }
}

// Scan line sweep
@keyframes scanLine {
    0% {
        top: 0%;
        opacity: 0;
    }
    5% {
        opacity: 0.6;
    }
    50% {
        opacity: 0.4;
    }
    95% {
        opacity: 0.6;
    }
    100% {
        top: 100%;
        opacity: 0;
    }
}

// Label fade in center
@keyframes labelFade {
    0%, 100% {
        opacity: 0;
    }
    40%, 60% {
        opacity: 0.6;
    }
}

// Label pulse
@keyframes labelPulse {
    0%, 100% {
        opacity: 0.3;
    }
    50% {
        opacity: 0.6;
    }
}

// ============================================
// Responsive
// ============================================
@media (max-width: 1024px) {
    .project-header-layout.has-visual.engram-visual {
        grid-template-columns: 1fr;
    }

    .project-visual.engram-project-visual {
        display: none;
    }
}
